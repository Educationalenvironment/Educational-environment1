<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ù†Ø´Ø·Ø© | TechZone</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
  font-family: 'Cairo', sans-serif;
  background: #eef2f5;
  margin: 0;
  padding: 0;
}

header {
  background: #0099cc;
  color: white;
  text-align: center;
  padding: 15px;
  font-size: 1.5rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

main {
  padding: 20px;
  overflow-x: auto;
}

section {
  margin-bottom: 40px;
}

section h2 {
  text-align: right;
  color: #333;
  font-size: 1.3rem;
  margin-bottom: 10px;
  padding-right: 10px;
  border-right: 5px solid #0099cc;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
table {
  width: 100%;
  min-width: 600px;
  border-collapse: collapse;
  background: white;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 0 8px rgba(0,0,0,0.08);
  animation: fadeIn 0.6s ease-in-out;
  margin-bottom: 20px;
}

th, td {
  padding: 10px;
  border-bottom: 1px solid #eee;
  text-align: center;
}

th {
  background-color: #f5f5f5;
  color: #333;
}

/* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± */
tr:hover {
  background-color: #f9f9f9;
}

img.icon {
  width: 30px;
  height: 30px;
}

/* Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ */
.no-results {
  text-align: center;
  color: #777;
  margin-top: 20px;
}

/* âœ… ÙØ§ØµÙ„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯Ø±Ø³ */
tr.lesson-separator td {
  background: #f1f8ff;
  color: #555;
  font-weight: 500;
  text-align: center;
  border-top: 1px dashed #99c;
  border-bottom: 1px dashed #99c;
  font-style: italic;
  letter-spacing: 1px;
}

/* âœ… ÙØ§ØµÙ„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙˆØ­Ø¯Ø© */
tr.unit-separator td {
  background: #e0f7fa;
  color: #006064;
  font-weight: bold;
  text-align: center;
  border-top: 2px solid #00acc1;
  border-bottom: 2px solid #00acc1;
  font-size: 1.05rem;
  letter-spacing: 2px;
}

/* Ù…ÙŠØ¯ÙŠØ§ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 600px) {
  header {
    font-size: 1.2rem;
    padding: 10px;
  }

  th, td {
    font-size: 0.85rem;
    padding: 8px 6px;
  }

  img.icon {
    width: 24px;
    height: 24px;
  }
}

/* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ø·ÙŠÙ */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

  </style>
</head>
<body>
  <header>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</header>

  <main>
    <!-- Ù‚Ø³Ù… Ø¨ÙŠØ¦Ø© Ø¶ØºØ· Ø§Ù„ÙˆÙ‚Øª -->
    <section>
      <h2>ğŸ“˜ Ù†ØªØ§Ø¦Ø¬ Ø¨ÙŠØ¦Ø© Ø¶ØºØ· Ø§Ù„ÙˆÙ‚Øª</h2>
      <table id="time-pressure-table">
        <thead>
          <tr>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
            <th>Ø§Ù„Ø¯Ø±Ø³</th>
            <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
            <th>Ø´Ø§Ø±Ø©</th>
            <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
          </tr>
        </thead>
        <tbody id="time-pressure-body"></tbody>
      </table>
      <p class="no-results" id="no-time-results" style="display:none;">
        Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¶Ù…Ù† Ø¨ÙŠØ¦Ø© Ø¶ØºØ· Ø§Ù„ÙˆÙ‚Øª.
      </p>
    </section>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø£Ø®Ø±Ù‰ -->
    <section>
      <h2>ğŸ“™ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø®Ø§ØµØ©</h2>
      <table id="other-activities-table">
        <thead>
          <tr>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
            <th>Ø§Ù„Ø¯Ø±Ø³</th>
            <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
            <th>Ø´Ø§Ø±Ø©</th>
            <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
          </tr>
        </thead>
        <tbody id="other-activities-body"></tbody>
      </table>
      <p class="no-results" id="no-other-results" style="display:none;">
        Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¶Ù…Ù† Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø£Ø®Ø±Ù‰.
      </p>
    </section>
  </main>

  <script>
const supabaseUrl = 'https://duxdtpkxomkjoxnlzjgw.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR1eGR0cGt4b21ram94bmx6amd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE5MTYyMzIsImV4cCI6MjA2NzQ5MjIzMn0._MOyOhSQvvKrmEwAJGvibp79JXM9MlTJyEVnpvuTJL0';
  const { createClient } = supabase;
  const supabaseClient = createClient(supabaseUrl, supabaseKey);

 const timePressureActivities = [
  "Ù†Ø´Ø§Ø· Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø£ÙˆÙ„ - Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰",
  "Ù†Ø´Ø§Ø· Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰",
  "Ù†Ø´Ø§Ø· Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø«Ø§Ù„Ø« - Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰",
  "Ù†Ø´Ø§Ø· Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø£ÙˆÙ„ - Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©",
  "Ù†Ø´Ø§Ø· Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©",
  "Ù†Ø´Ø§Ø· Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø«Ø§Ù„Ø« - Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©",
  "Ù†Ø´Ø§Ø· Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø£ÙˆÙ„ - Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©",
  "Ù†Ø´Ø§Ø· Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©",
  "Ù†Ø´Ø§Ø· Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø«Ø§Ù„Ø« - Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©",
  "Ù†Ø´Ø§Ø· Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø£ÙˆÙ„ - Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©",
  "Ù†Ø´Ø§Ø· Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©",
  "Ù†Ø´Ø§Ø· Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø«Ø§Ù„Ø« - Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©"
];

async function fetchResults() {
  const { data, error } = await supabaseClient
    .from('activities_results')
    .select('*');

  const timeBody = document.getElementById('time-pressure-body');
  const otherBody = document.getElementById('other-activities-body');
  const noTimeMsg = document.getElementById('no-time-results');
  const noOtherMsg = document.getElementById('no-other-results');

  if (error) {
    console.error('Ø­Ø¯Ø« Ø®Ø·Ø£:', error.message);
    timeBody.innerHTML = '<tr><td colspan="6">âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</td></tr>';
    otherBody.innerHTML = '<tr><td colspan="6">âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</td></tr>';
    return;
  }

  if (!data || data.length === 0) {
    noTimeMsg.style.display = 'block';
    noOtherMsg.style.display = 'block';
    return;
  }

  const createRow = (result) => {
    const row = document.createElement('tr');
    let badge = '-';
    if (result.trophy) {
      badge = `<img src="${result.trophy}" alt="ÙƒØ£Ø³" class="icon">`;
    } else if (result.gold_check) {
      badge = `<img src="${result.gold_check}" alt="ØµØ­ Ø°Ù‡Ø¨ÙŠ" class="icon">`;
    } else if (result.check_mark) {
      badge = `<img src="${result.check_mark}" alt="ØµØ­" class="icon">`;
    }

    row.innerHTML = `
      <td>${result.name}</td>
      <td>${result.email}</td>
      <td>${result.lesson}</td>
      <td>${result.score}</td>
      <td>${badge}</td>
      <td>${result.rank ?? '-'}</td>
    `;
    return row;
  };

  const insertResultsGroupedByUnit = (results, orderList, container) => {
    const units = [...new Set(orderList.map(lesson => {
      const match = lesson.match(/Ø§Ù„ÙˆØ­Ø¯Ø©\s+\S+/);
      return match ? match[0] : '';
    }))];

    units.forEach(unitName => {
      const lessonsInUnit = orderList.filter(lesson => lesson.includes(unitName));

      lessonsInUnit.forEach(lessonTitle => {
        const lessonResults = results.filter(r => r.lesson === lessonTitle);

        if (lessonResults.length > 0) {
          lessonResults.forEach(r => container.appendChild(createRow(r)));

          // ÙØ§ØµÙ„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯Ø±Ø³
          const lessonSeparator = document.createElement('tr');
          lessonSeparator.className = "lesson-separator";
          lessonSeparator.innerHTML = `<td colspan="6">---------- Ù†Ù‡Ø§ÙŠØ© ${lessonTitle.split('-')[0].trim()} ----------</td>`;
          container.appendChild(lessonSeparator);
        }
      });

      // ÙØ§ØµÙ„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙˆØ­Ø¯Ø© Ø¨Ø¹Ø¯ ÙƒÙ„ Ø¯Ø±ÙˆØ³ Ø§Ù„ÙˆØ­Ø¯Ø©
      const unitSeparator = document.createElement('tr');
      unitSeparator.className = "unit-separator";
      unitSeparator.innerHTML = `<td colspan="6">========== Ù†Ù‡Ø§ÙŠØ© ${unitName} ==========</td>`;
      container.appendChild(unitSeparator);
    });
  };

  const timeResults = data.filter(r => timePressureActivities.includes(r.lesson));
  const otherResults = data.filter(r => !timePressureActivities.includes(r.lesson));

  // Ø¹Ø±Ø¶ Ø¨ÙŠØ¦Ø© Ø¶ØºØ· Ø§Ù„ÙˆÙ‚Øª
  if (timeResults.length > 0) {
    insertResultsGroupedByUnit(timeResults, timePressureActivities, timeBody);
  } else {
    noTimeMsg.style.display = 'block';
  }

  // ØªØ±ØªÙŠØ¨ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ lesson name
  if (otherResults.length > 0) {
    const otherLessonsOrder = [...new Set(otherResults.map(r => r.lesson))].sort((a, b) => a.localeCompare(b));
    insertResultsGroupedByUnit(otherResults, otherLessonsOrder, otherBody);
  } else {
    noOtherMsg.style.display = 'block';
  }
}

fetchResults();

</script>

</body>


</html>
